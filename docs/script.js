/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
/******/ (() => { // webpackBootstrap
/******/ 	var __webpack_modules__ = ({

/***/ "./src/script.js":
/*!***********************!*\
  !*** ./src/script.js ***!
  \***********************/
/***/ (() => {

eval("// https://www.strava.com/oauth/token?client_id=41469&client_secret=0743f07f60f0eca5e78db28f88f78032a10067b8&code=306f962434700f1503a4478f7971af0f0f54e1f7&grant_type=authorization_code\n\nrefreshToken = \"c6d059e946455c72bfdaa2a4f78e8172c7a200a5\";\n\nlet stravaId = \"\";\nlet randomRoute = [];\nlet routeId = \"\";\nlet time = \"\";\nlet userId = localStorage.getItem('id');\nlet username = localStorage.getItem('username');\nlet password = localStorage.getItem('username');\n\nwindow.onload = function(){\n    document.getElementById('map').style.display = \"none\";\n    inputs();\n};\n\nasync function getRoutes(data){\n    //fetch routes\n    let response = await fetch(`https://www.strava.com/api/v3/athletes/${stravaId}/routes?access_token=${data.access_token}`);\n    return await response.json()\n    .then(data => {\n        getRandomRoute(data);\n    });\n};\n\nfunction getNewAccessToken(){\n    //Access Token expires so needs to be refreched by using the refresh token. \n    //code from postman\n    var myHeaders = new Headers();\n    myHeaders.append(\"Cookie\", \"_strava4_session=mp0pj628d3j9937dl8jpvfh0lrnbg0b1\");\n\n    var requestOptions = {\n    method: 'POST',\n    headers: myHeaders,\n    redirect: 'follow'\n    };\n\n    temp = \"\";\n\n    fetch(\"https://www.strava.com/oauth/token?client_id=41469&client_secret=0743f07f60f0eca5e78db28f88f78032a10067b8&refresh_token=c6d059e946455c72bfdaa2a4f78e8172c7a200a5 &grant_type=refresh_token\", requestOptions)\n    .then(response => response.json())\n    .then(data => getRoutes(data))\n    .catch(error => console.log('error', error));\n};\n\nfunction leafletMap(){\n    \n    document.getElementById('map').style.display = \"block\";\n    document.getElementById('pageDiv').style.display = \"none\";\n\n    //code from leafletjs.com\n    //creates map\n    let map = L.map('map').setView([50.7889886,4.168973,11], 10);\n    //uses mapbox\n    L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {\n    attribution: 'Map data &copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors, Imagery Â© <a href=\"https://www.mapbox.com/\">Mapbox</a>',\n    maxZoom: 18,\n    id: 'mapbox/dark-v10',\n    tileSize: 512,\n    zoomOffset: -1,\n    accessToken: 'pk.eyJ1Ijoicm9iYm9zbWFucyIsImEiOiJja3dnampsMnkwcDluMm9wbWp6YW94M2dmIn0.YNnModWsj0A6qUNYPPUj9Q'\n    }).addTo(map);\n\n    let coordinates = L.Polyline.fromEncoded(randomRoute.map.summary_polyline).getLatLngs()\n    //draws line on map\n    L.polyline(coordinates,\n        {\n            color: \"#FC5200\",\n            weight: 2,\n            lineJoin: \"round\"\n        }).addTo(map);\n    //Save route id\n    routeId = randomRoute.id_str;\n    window.localStorage.setItem(\"routeId\", routeId);\n    //Seconds to hours and minutes\n    time = randomRoute.estimated_moving_time;\n    //route info\n    document.getElementById('map').insertAdjacentHTML('beforebegin', \n        `\n        <div id=\"column1\">\n            <div id=\"routeInfo\">\n                <h1>Route:</h1>\n                <ul>\n                    <li>${randomRoute.name}</li>\n                    <li id=\"inlineLi\"><i class=\"fas fa-ruler-horizontal\"></i> ${Math.round((randomRoute.distance)/1000)}km</li>\n                    <li id=\"inlineLi\"><i class=\"fas fa-mountain\"></i> ${Math.round(randomRoute.elevation_gain)}m</li>\n                    <li id=\"inlineLi\"><i class=\"fas fa-clock\"></i> ${secondsToHms()}</li>\n                </ul>\n                <div id=\"selectRoute\">\n                    <button class=\"button\">Select route</button>\n                </div>\n                <button class=\"button\" id=\"anotherRouteButton\"><i class=\"fas fa-random\"></i></button>\n            </div>\n        </div>\n        `\n    );\n    //get another random route\n    document.getElementById('routeInfo').addEventListener('click', e =>{\n        e.preventDefault();\n        map.remove();\n        document.getElementById('selectRoute').remove();\n        document.getElementById('routeInfo').remove();\n        document.getElementById('column1').remove();\n        getNewAccessToken();\n    });\n    //save route\n    document.getElementById('selectRoute').addEventListener('click', e =>{\n        e.preventDefault();\n        saveRoute();\n    });\n};\n\nfunction inputs(){\n    document.getElementById('mainForm').addEventListener('submit', e => {\n        e.preventDefault();\n\n        stravaId = document.getElementById('stravaId').value;\n        if(stravaId == 0){\n            document.getElementById('message').insertAdjacentHTML(\"beforebegin\",\n                \"<p>Wrong strava ID</p>\"\n            );\n        }else{\n            getNewAccessToken();\n        }\n    });\n}\n\nfunction getRandomRoute(data){\n    randomRoute = data[Math.floor(Math.random() * 30)];\n    leafletMap();\n}\n\nfunction anotherRandomRoute(){\n    document.getElementById('routeInfo').addEventListener('click', e =>{\n        e.preventDefault();\n        location.reload();\n    });\n}\n\nasync function saveRoute(){\n    var myHeaders = new Headers();\n    myHeaders.append(\"Content-Type\", \"application/json\");\n\n    var raw = JSON.stringify({\n    \"name\": username,\n    \"password\": password,\n    \"routes\": routeId\n    });\n\n    var requestOptions = {\n    method: 'PUT',\n    headers: myHeaders,\n    body: raw,\n    redirect: 'follow'\n    };\n\n    fetch(`https://stravaroutesapp.herokuapp.com/login/${userId}`, requestOptions)\n    .then(response => response.text())\n    .then(result => console.log(result))\n    .catch(error => console.log('error', error))\n    .then(document.location.href = \"end.html\");\n}\n\nfunction secondsToHms() {\n    var h = Math.floor(time / 3600);\n    var m = Math.floor(time % 3600 / 60);\n\n    var hDisplay = h + \"h \";\n    var mDisplay = m + \"m \";\n    return hDisplay + mDisplay; \n}\n\n//# sourceURL=webpack://web2-frontend-robbosmans/./src/script.js?");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module can't be inlined because the eval devtool is used.
/******/ 	var __webpack_exports__ = {};
/******/ 	__webpack_modules__["./src/script.js"]();
/******/ 	
/******/ })()
;